<div class="screen screen-gameover" [attr.score-saved]="scoreSaved ? true : null">
  <h2 class="screen-title">Game Over</h2>
  <p class="screen-score">Your Score: {{ score.toString().padStart(4, '0') }}</p>

  <!-- Name Entry Section: Only visible until score is saved -->
  <div class="save-score-section" *ngIf="!scoreSaved">
    <h3 class="save-score-title">Save Your Score</h3>
    <div class="arcade-name-entry-embedded" *ngIf="showNameEntry">
      <app-arcade-name-entry
        [initialName]="playerName"
        (nameConfirmed)="onNameConfirmed($event)"
        (cancelled)="onNameEntryCancelled()"
      >
      </app-arcade-name-entry>
    </div>
    <div class="save-messages">
      <p class="save-error" *ngIf="saveError">Failed to save score. Please try again.</p>
      <p class="save-success" *ngIf="saveSuccess">Score saved successfully!</p>
    </div>
  </div>

  <!-- Score Saved Message -->
  <div class="score-saved-message" *ngIf="scoreSaved">
    <p class="save-success">✓ Your score has been saved as {{ playerName }}!</p>
  </div>

  <!-- Leaderboard and Menu: Only visible after score is saved -->
  <div class="gameover-flex-row" *ngIf="scoreSaved">
    <div class="highscore-side">
      <h3 class="screen-subtitle">
        Leaderboard
        <button
          class="refresh-btn"
          (click)="refreshLeaderboard()"
          title="Refresh leaderboard"
          aria-label="Refresh leaderboard"
          type="button"
        >
          ↻
        </button>
      </h3>
      <div class="highscore-container">
        <div *ngIf="isLoading" class="highscore-loading">Loading scores...</div>
        <div *ngIf="hasError" class="highscore-error">
          <p>Could not load online scores. Please check your connection.</p>
        </div>
        <ul class="highscore-list" *ngIf="!isLoading && !hasError && highscoreEntries.length > 0">
          <li *ngFor="let entry of highscoreEntries; let i = index" class="highscore-entry">
            <span class="rank">{{ i + 1 }}.</span>
            <span class="player-name">{{ entry.playerName }}</span>
            <span class="score">{{ entry.score.toString().padStart(4, '0') }}</span>
          </li>
        </ul>
        <div *ngIf="!isLoading && !hasError && highscoreEntries.length === 0" class="no-scores">
          <p>No Highscores yet - be the first!</p>
        </div>
      </div>
    </div>
    <div class="menu-btn-col" (keydown)="keydownHandler($event)">
      <button
        #menuBtn
        class="menu-btn"
        [class.selected]="selectedIndex === 0"
        (click)="restart.emit()"
      >
        Restart
      </button>
      <button
        #menuBtn
        class="menu-btn"
        [class.selected]="selectedIndex === 1"
        (click)="backToMenu.emit()"
      >
        Back to Menu
      </button>
    </div>
  </div>
</div>
